<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-info { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center;
            z-index: 1000;
        }
        .login-prompt { 
            background: white; padding: 30px; border-radius: 10px; text-align: center; 
        }
        .login-btn { 
            background: #007bff; color: white; border: none; padding: 10px 20px; 
            border-radius: 5px; cursor: pointer; margin-top: 15px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è®¤è¯çŠ¶æ€è°ƒè¯•</h1>
    
    <div class="debug-info">
        <h3>é¡µé¢ä¿¡æ¯</h3>
        <p><strong>å½“å‰URL:</strong> <span id="current-url"></span></p>
        <p><strong>é¡µé¢è·¯å¾„:</strong> <span id="current-path"></span></p>
    </div>

    <div class="debug-info">
        <h3>Metaæ ‡ç­¾æ£€æŸ¥</h3>
        <p><strong>auth-required meta:</strong> <span id="auth-meta"></span></p>
    </div>

    <div class="debug-info">
        <h3>Cookieä¿¡æ¯</h3>
        <p><strong>æ‰€æœ‰Cookies:</strong> <span id="all-cookies"></span></p>
        <p><strong>sessionToken:</strong> <span id="session-token"></span></p>
    </div>

    <div class="debug-info">
        <h3>LocalStorageä¿¡æ¯</h3>
        <p><strong>sessionToken:</strong> <span id="local-session-token"></span></p>
    </div>

    <div class="debug-info">
        <h3>DOMå…ƒç´ æ£€æŸ¥</h3>
        <p><strong>login-overlayå…ƒç´ :</strong> <span id="overlay-exists"></span></p>
        <p><strong>å½“å‰displayæ ·å¼:</strong> <span id="overlay-display"></span></p>
    </div>

    <div class="debug-info">
        <h3>æ“ä½œæµ‹è¯•</h3>
        <button onclick="showOverlay()">æ˜¾ç¤ºç™»å½•é®ç½©</button>
        <button onclick="hideOverlay()">éšè—ç™»å½•é®ç½©</button>
        <button onclick="clearAuth()">æ¸…é™¤è®¤è¯ä¿¡æ¯</button>
    </div>

    <!-- ç™»å½•é®ç½© -->
    <div id="login-overlay" class="login-overlay" style="display: none;">
        <div class="login-prompt">
            <h2>è¯·å…ˆç™»å½•</h2>
            <p>ä½¿ç”¨ Gemini Playground éœ€è¦å…ˆç™»å½•è´¦æˆ·</p>
            <button class="login-btn" onclick="goToLogin()">å‰å¾€ç™»å½•</button>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œè°ƒè¯•
        document.addEventListener('DOMContentLoaded', () => {
            updateDebugInfo();
            
            // æ¨¡æ‹Ÿè®¤è¯æ£€æŸ¥é€»è¾‘
            checkAuthDebug();
        });

        function updateDebugInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('current-path').textContent = window.location.pathname;
            
            // æ£€æŸ¥metaæ ‡ç­¾
            const authMeta = document.querySelector('meta[name="auth-required"]');
            document.getElementById('auth-meta').textContent = authMeta ? authMeta.content : 'æœªæ‰¾åˆ°';
            
            // Cookieä¿¡æ¯
            document.getElementById('all-cookies').textContent = document.cookie || 'æ— ';
            const sessionToken = getSessionTokenFromCookie();
            document.getElementById('session-token').textContent = sessionToken || 'æ— ';
            
            // LocalStorageä¿¡æ¯
            document.getElementById('local-session-token').textContent = localStorage.getItem('sessionToken') || 'æ— ';
            
            // DOMå…ƒç´ æ£€æŸ¥
            const overlay = document.getElementById('login-overlay');
            document.getElementById('overlay-exists').textContent = overlay ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨';
            document.getElementById('overlay-display').textContent = overlay ? overlay.style.display : 'N/A';
        }

        function getSessionTokenFromCookie() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'sessionToken') {
                    return decodeURIComponent(value);
                }
            }
            return null;
        }

        function checkAuthDebug() {
            console.log('ğŸ” å¼€å§‹è®¤è¯æ£€æŸ¥...');
            
            // æ£€æŸ¥metaæ ‡ç­¾
            const authMeta = document.querySelector('meta[name="auth-required"]');
            if (authMeta && authMeta.content === 'true') {
                console.log('âœ… å‘ç°auth-required metaæ ‡ç­¾ï¼Œåº”è¯¥æ˜¾ç¤ºç™»å½•é®ç½©');
                showOverlay();
                return;
            }
            
            // æ£€æŸ¥sessionToken
            const sessionToken = getSessionTokenFromCookie() || localStorage.getItem('sessionToken');
            if (!sessionToken) {
                console.log('âŒ æ²¡æœ‰sessionTokenï¼Œåº”è¯¥æ˜¾ç¤ºç™»å½•é®ç½©');
                showOverlay();
                return;
            }
            
            console.log('âœ… æœ‰sessionTokenï¼Œéœ€è¦éªŒè¯æœ‰æ•ˆæ€§');
            // è¿™é‡Œåº”è¯¥è°ƒç”¨APIéªŒè¯token
        }

        function showOverlay() {
            const overlay = document.getElementById('login-overlay');
            if (overlay) {
                overlay.style.display = 'flex';
                console.log('âœ… ç™»å½•é®ç½©å·²æ˜¾ç¤º');
                updateDebugInfo();
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°ç™»å½•é®ç½©å…ƒç´ ');
            }
        }

        function hideOverlay() {
            const overlay = document.getElementById('login-overlay');
            if (overlay) {
                overlay.style.display = 'none';
                console.log('âœ… ç™»å½•é®ç½©å·²éšè—');
                updateDebugInfo();
            }
        }

        function clearAuth() {
            document.cookie = 'sessionToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
            localStorage.removeItem('sessionToken');
            console.log('âœ… è®¤è¯ä¿¡æ¯å·²æ¸…é™¤');
            updateDebugInfo();
            checkAuthDebug();
        }

        function goToLogin() {
            window.location.href = '/login.html';
        }
    </script>
</body>
</html>
